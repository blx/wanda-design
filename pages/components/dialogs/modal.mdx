import { useState } from "react";
import { MdxLayout } from "@/components/layouts/mdx";
import { Playground } from "@/components/playground";
import { Props } from "@/components/props";
import dynamic from "next/dynamic";
import * as Components from "@wonderflow/react-components";

export const DynPortal = dynamic(
  import("@/components/portal").then((m) => m.Portal),
  { ssr: false }
);

export const example = `() => {
  const [visible, setVisible] = useState(false);
  return (
    <>
      <Button onClick={() => setVisible(true)}>Show Modal</Button>
      <DynPortal>
        <Modal
          key="default-modal"
          visible={visible}
          onClose={() => setVisible(false)}
        >
          <Modal.Content title="Account deletion">
            <Stack
              fill={false}
              horizontalAlign="center"
              rowGap={32}
              horizontalPadding={24}
              verticalPadding={24}
            >
              <Text>Do you really want to delete this account?</Text>
              <Stack direction="row" columnGap={8}>
                <Button onClick={() => setVisible(false)} kind="flat">
                  No
                </Button>
                <Button onClick={() => setVisible(false)}>Confirm</Button>
              </Stack>
            </Stack>
          </Modal.Content>
        </Modal>
      </DynPortal>
    </>
  );
}`;

export default ({ children }) => (
  <MdxLayout
    title="Modal"
    description="A window overlaid on either the primary window, rendering the content underneath inert."
    showMeta
    features={[
      "Keyboard accessible",
      "Focus is automatically trapped when modal",
      "Can be controlled or uncontrolled",
      "Manages screen reader announcements with Title",
      "Themes ready",
    ]}
    links={[
      {
        label: "ARIA design",
        url: "https://www.w3.org/TR/wai-aria-1.2/#dialog",
      },
      {
        label: "ARIA authoring",
        url: "https://www.w3.org/TR/wai-aria-practices-1.2/#dialog_modal",
      },
    ]}
    hero={
      <Playground
        scope={{ ...Components, useState, DynPortal }}
        code={example}
      />
    }
  >
    {children}
  </MdxLayout>
);

## Anatomy

```tsx highlight=1,4,7-9
import { Modal } from "@wonderflow/react-components";

export default () => {
  const [visible, setVisible] = useState<boolean>(false);

  return (
    <Modal visible={visible} title="Modal title">
      <Modal.Content>....</Modal.Content>
    </Modal>
  );
};
```

### Dynamic mounting

In some situations you need to dynamically mount the `Modal` component based on a condition, instead of using the `visible` property. In these cases, you need to wrap the `Modal` and the `condition` inside the `Presence` provider in order to keep the exiting animation.

```tsx highlight=1,4,5,8-15
import { Modal, useModalContext, Presence } from "@wonderflow/react-components";

export default () => {
  const [visible, setVisible] = useState<boolean>(false);
  const { titleId, onClose } = useModalContext();

  return (
    <Presence>
      {visible && (
        <Modal title="Modal title">
          <p id={titleId}>Modal title</p>
          <button onClick={onClose}>Close modal</button>
        </Modal>
      )}
    </Presence>
  );
};
```

### Custom content

If you want to use the `Modal` component to show custom elements instead of the `Modal.Content` (which renders the card), you can pass an element inside it.

```tsx highlight=1,4,7-9
import { Modal } from "@wonderflow/react-components";

export default () => {
  const [visible, setVisible] = useState<boolean>(false);

  return (
    <Modal visible={visible} title="Modal title">
      <div>My custom content wrapper</div>
    </Modal>
  );
};
```

<Components.Snackbar kind="warning">
  It's important to consider that by passing custom content you have to handle
  the overflow, size, position and accessibility by yourself.
</Components.Snackbar>

## API Reference

### Modal

<Props
  properties={[
    {
      name: "visible",
      type: ['"boolean"'],
      default: "false",
      required: false,
      dangerous: false,
      description: "Set the visibility and render of the modal",
    },
    {
      name: "overlayColor",
      type: ["light", "dark", "auto"],
      default: '"dark"',
      required: false,
      dangerous: false,
      description: "Set the backdrop overlay color",
    },
    {
      name: "onClose",
      type: ["() => void"],
      default: "",
      required: true,
      dangerous: false,
      description:
        "Callback to close the modal. This is used on the overlay and the close button if Modal.Content is used.",
    },
    {
      name: "closeOnClickOutside",
      type: ["boolean"],
      default: "true",
      required: false,
      dangerous: false,
      description: "Run onClose callback when clicking the backdrop layer",
    },
  ]}
/>

### Modal.Content

<Props
  properties={[
    {
      name: "title",
      type: ['"ReactNode"'],
      default: "",
      required: true,
      dangerous: false,
      description: "The modal title which labels the modal to AT",
    },
  ]}
/>

### useModalContext

<Props
  properties={[
    {
      name: "titleId",
      type: ["string"],
      default: "",
      required: false,
      dangerous: false,
      description:
        "The auto generated id to assign to the modal title to give it an accessbility name",
    },
    {
      name: "onClose",
      type: ["() => void"],
      default: "",
      required: false,
      dangerous: false,
      description:
        "The callback passed to the Modal and available inside the Modal content.",
    },
  ]}
/>

## Accessibility

Adheres to the [`dialog` role requirements](https://www.w3.org/TR/wai-aria-1.2/#dialog).

### Keyboard interactions

<Props
  properties={[
    {
      name: "tab",
      description: "Moves focus to the next focusable element inside the modal",
    },
    {
      name: "shif + tab",
      description:
        "Moves focus to the previous focusable element inside the modal",
    },
    {
      name: "esc",
      description: "Close the modal and move the focus on the trigger element",
    },
  ]}
/>
